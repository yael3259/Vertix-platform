# Vertix Platform â€“ Backend (Node.js)

## Project Description
**Vertix** is the Backend of a social platform for personal goal management, posts, and achievements. The system allows users to create and share posts, follow other users, earn points, receive badges for accomplishments, and manage daily achievements and weekly boosts.

---

## Table of Contents
* [Features](#features)
* [Technologies](#technologies)
* [Folder Structure](#folder-structure)
* [Controllers](#controllers)
* [API Endpoints](#api-endpoints)
* [Installation & Usage](#installation--usage)

---

## Features
* **User Management**: Registration, login, deletion, profile updates, and password reset.
* **Security**: JWT authentication and password encryption with Bcryptjs.
* **Posts & Comments**: Create, edit, delete posts, add likes and comments, with image upload support via Multer and Sharp.
* **Achievements System**: Create daily achievements and weekly boosts, with automatic point calculation.
* **Notifications**: Alerts for likes, comments, tables updates, and new followers.
* **Social Network**: Users can follow others and view their followers lists.
* **Weekly Leaderboard**: A Cron Job that awards Gold, Silver, and Bronze badges to the top users based on their scores.

---

## Technologies
* Node.js, Express.js
* MongoDB with Mongoose
* JSON Web Token (JWT)
* Bcryptjs
* Multer, Sharp
* node-cron
* Joi
* CORS

---

## Folder Structure
* `controllers/`: Contains the core API logic and business rules.
* `models/`: Defines the MongoDB schemas for the database collections.
* `routes/`: Specifies the API endpoints and directs requests to the correct controllers.
* `uploads/`: A directory for uploaded user files, such as profile pictures and post images.
* `node_modules/`: Automatically generated by npm, containing all project dependencies.
* `package.json`: Lists the project's dependencies and available scripts.
* `server.js` / `index.js`: The main entry point of the server application.
* `.env`: A file for storing environment variables like database connections and secret keys.

---

## Controllers

### User Controller (`user.controller.js`)
* **`createUser`**: Handles new user registration, including password encryption with Bcryptjs.
* **`userLogin`**: Authenticates a user and generates a JWT for secure access.
* **`deleteUser`**: Deletes a user account and all associated data, including posts, notifications, and achievements.
* **`updateUser`**: Allows users to update their details and profile picture, with image processing via Multer and Sharp.
* **`getLoggedInUser`**: Fetches all information about the currently authenticated user.
* **`getUserDetails`**: Retrieves specific user data by their unique ID.
* **`followUser`**: Manages the following/unfollowing functionality between users.
* **`updatePoints`**: A dedicated function to add points to a user's score, primarily for the achievements and leaderboard systems.

### Post Controller (`post.controller.js`)
* **`createPost`**: Creates a new post with a description and optional image.
* **`updatePost`**: Edits an existing post's content.
* **`deletePost`**: Deletes a post; restricted to the post's creator or an admin.
* **`getPost`**: Retrieves a single post by its ID.
* **`getAllPosts`**: Fetches all posts from the database for the main feed.
* **`likePost`**: Toggles a like on a post, ensuring each user can only like a post once.
* **`commentPost`**: Allows users to add a comment to a specific post.

### Achievement Controller (`achievement.controller.js`)
* **`createAchievement`**: Creates a new daily achievement for a user.
* **`createBoost`**: Creates a new boost (a smaller, trackable goal) linked to a main achievement.
* **`updateAchievement`**: Updates the status of an achievement and awards points upon completion.
* **`updateBoost`**: Updates a boost's status and automatically reflects the change in the main achievement.
* **`getAllUserAchievements`**: Retrieves a list of all achievements and boosts for a specific user.

### Notification Controller (`notification.controller.js`)
* **`getAllUserNotifications`**: Fetches all notifications for the authenticated user.
* **`updateNotificationStatus`**: Marks a notification as "read."

---

## API Endpoints

### Users (`/domain/api/user`)
| Method | Path | Description |
| :--- | :--- | :--- |
| `GET` | `/` | Retrieves all users |
| `GET` | `/:userId` | Retrieves a specific user by ID |
| `POST` | `/` | Creates a new user |
| `POST` | `/login` | Authenticates a user and returns a JWT |
| `PUT` | `/` | Resets a user's password |
| `PUT` | `/update/:userId` | Updates a user's details |
| `PUT` | `/updatePoints/:userId` | Adds points to a user's score |
| `DELETE` | `/:userId` | Deletes a user |

### Posts (`/domain/api/post`)
| Method | Path | Description |
| :--- | :--- | :--- |
| `GET` | `/` | Retrieves all posts |
| `GET` | `/:userId` | Retrieves all posts by a specific user |
| `POST` | `/` | Creates a new post |
| `POST` | `/like/:userId` | Adds or removes a like on a post |
| `POST` | `/comment/:postId` | Adds a comment to a post |
| `PUT` | `/:postId` | Edits an existing post |
| `DELETE` | `/:postId` | Deletes a post |

### Achievements (`/domain/api/achievement`)
| Method | Path | Description |
| :--- | :--- | :--- |
| `GET` | `/` | Retrieves all achievements |
| `GET` | `/achievements/:userId`| Retrieves achievements for a specific user |
| `POST` | `/` | Creates a new achievement |
| `POST` | `/boost` | Creates a new boost |
| `PUT` | `/updateAchievement/:achievementId` | Updates an achievement's status |
| `PUT` | `/updateBoost/:boostId` | Updates a boost's status |

---

## Installation & Usage
1.  **Clone the Repository**
    Start by cloning the project code from the repository and navigating into the directory:
    ```bash
    git clone [https://github.com/yael3259/Vertix-platform.git](https://github.com/yael3259/Vertix-platform.git)
    cd Vertix-platform
    ```
2.  **Install Dependencies**
    Install all the necessary project dependencies by running the following command:
    ```bash
    npm install
    ```
3.  **Configure `.env` file**  
    Copy the template below into a new file named `.env` in the project root (or rename `.env.example` to `.env`) and replace the placeholders with your actual values:  

    ```env
    # Security
    SECRET_JWT=<JWT_SECRET_KEY>

    # Database
    DB_URI=<PRIMARY_MONGODB_URI>
    MONGO_URI=<SECONDARY_MONGODB_URI>

    # Server
    BACKEND_HOST=<BACKEND_BASE_URL>

    # Application
    ROLE_CODE=<USER_ROLE_CODE>
    ```

4.  **Start the Server**
    To run the server, use one of the following commands:
    * **Development mode (recommended):**
        ```bash
        npm run dev
        ```
    * **Normal run:**
        ```bash
        npm start
        ```
    The server will run on port 5000 by default.